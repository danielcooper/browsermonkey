<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 12 (filtered)">
<title>Low Level Design</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Arial","sans-serif";}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Arial","sans-serif";
	font-style:italic;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Arial","sans-serif";}
h4
	{mso-style-link:"Heading 4 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";}
h5
	{mso-style-link:"Heading 5 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	font-size:13.0pt;
	font-family:"Arial","sans-serif";
	font-style:italic;}
h6
	{mso-style-link:"Heading 6 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";}
p.MsoHeading7, li.MsoHeading7, div.MsoHeading7
	{mso-style-link:"Heading 7 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{mso-style-link:"Heading 8 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";
	font-style:italic;}
p.MsoHeading9, li.MsoHeading9, div.MsoHeading9
	{mso-style-link:"Heading 9 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	font-size:11.0pt;
	font-family:"Cambria","serif";}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:12.0pt;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:24.0pt;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{mso-style-link:"Caption Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	font-size:9.0pt;
	font-family:"Arial","sans-serif";
	color:#4F81BD;
	font-weight:bold;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"Title Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	text-align:center;
	font-size:16.0pt;
	font-family:"Cambria","serif";
	font-weight:bold;}
p.MsoSubtitle, li.MsoSubtitle, div.MsoSubtitle
	{mso-style-link:"Subtitle Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	text-align:center;
	font-size:12.0pt;
	font-family:"Cambria","serif";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
em
	{font-family:"Calibri","sans-serif";
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:0cm;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
p.MsoNoSpacing, li.MsoNoSpacing, div.MsoNoSpacing
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:36.0pt;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:36.0pt;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";}
p.MsoQuote, li.MsoQuote, div.MsoQuote
	{mso-style-link:"Quote Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";
	font-style:italic;}
p.MsoIntenseQuote, li.MsoIntenseQuote, div.MsoIntenseQuote
	{mso-style-link:"Intense Quote Char";
	margin-top:12.0pt;
	margin-right:36.0pt;
	margin-bottom:12.0pt;
	margin-left:36.0pt;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";
	font-weight:bold;
	font-style:italic;}
span.MsoSubtleEmphasis
	{color:#5A5A5A;
	font-style:italic;}
span.MsoIntenseEmphasis
	{font-weight:bold;
	font-style:italic;
	text-decoration:underline;}
span.MsoSubtleReference
	{text-decoration:underline;}
span.MsoIntenseReference
	{font-weight:bold;
	text-decoration:underline;}
span.MsoBookTitle
	{font-family:"Cambria","serif";
	font-weight:bold;
	font-style:italic;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Arial","sans-serif";
	font-weight:bold;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Arial","sans-serif";
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Arial","sans-serif";
	font-weight:bold;
	font-style:italic;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Arial","sans-serif";
	font-weight:bold;}
span.Heading4Char
	{mso-style-name:"Heading 4 Char";
	mso-style-link:"Heading 4";
	font-family:"Arial","sans-serif";
	font-weight:bold;}
span.Heading5Char
	{mso-style-name:"Heading 5 Char";
	mso-style-link:"Heading 5";
	font-weight:bold;
	font-style:italic;}
span.Heading6Char
	{mso-style-name:"Heading 6 Char";
	mso-style-link:"Heading 6";
	font-weight:bold;}
span.Heading7Char
	{mso-style-name:"Heading 7 Char";
	mso-style-link:"Heading 7";}
span.Heading8Char
	{mso-style-name:"Heading 8 Char";
	mso-style-link:"Heading 8";
	font-style:italic;}
span.Heading9Char
	{mso-style-name:"Heading 9 Char";
	mso-style-link:"Heading 9";
	font-family:"Cambria","serif";}
span.TitleChar
	{mso-style-name:"Title Char";
	mso-style-link:Title;
	font-family:"Cambria","serif";
	font-weight:bold;}
span.SubtitleChar
	{mso-style-name:"Subtitle Char";
	mso-style-link:Subtitle;
	font-family:"Cambria","serif";}
span.QuoteChar
	{mso-style-name:"Quote Char";
	mso-style-link:Quote;
	font-style:italic;}
span.IntenseQuoteChar
	{mso-style-name:"Intense Quote Char";
	mso-style-link:"Intense Quote";
	font-weight:bold;
	font-style:italic;}
p.Code, li.Code, div.Code
	{mso-style-name:Code;
	mso-style-link:"Code Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
span.CodeChar
	{mso-style-name:"Code Char";
	mso-style-link:Code;
	font-family:"Courier New";}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;
	font-family:"Arial","sans-serif";}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;
	font-family:"Arial","sans-serif";}
p.FigureCaptionStyle, li.FigureCaptionStyle, div.FigureCaptionStyle
	{mso-style-name:"Figure Caption Style";
	mso-style-link:"Figure Caption Style Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	font-size:9.0pt;
	font-family:"Arial","sans-serif";
	color:#4F81BD;
	font-weight:bold;}
span.CaptionChar
	{mso-style-name:"Caption Char";
	mso-style-link:Caption;
	font-family:"Arial","sans-serif";
	color:#4F81BD;
	font-weight:bold;}
span.FigureCaptionStyleChar
	{mso-style-name:"Figure Caption Style Char";
	mso-style-link:"Figure Caption Style";
	font-family:"Arial","sans-serif";
	color:#4F81BD;
	font-weight:bold;}
.MsoPapDefault
	{margin-bottom:10.0pt;
	line-height:115%;}
 /* Page Definitions */
 @page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 72.0pt 72.0pt 72.0pt;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=EN-GB link=blue vlink=purple>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:16.0pt'>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:36.0pt'>BrowserMonkey</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:16.0pt'>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:16.0pt'>&nbsp;</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:16.0pt'><img width=309 height=309
src="Low%20Level%20Design_files/image001.jpg" alt="dangly monkey"></span></b></p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt'>&nbsp;</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt'>&nbsp;</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt'>&nbsp;</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:18.0pt'>Low Level Design Document</span></b></p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'>v 1.0</p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:18.0pt'>&nbsp;</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:14.0pt'>Software House One</span></b></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><b><span style='font-size:16.0pt'>Version History</span></b></p>

<p class=MsoNoSpacing><span lang=EN-US>Document name: Design Team/scratch/Low
Level/Low Level Design.docx</span></p>

<p class=MsoNoSpacing><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document version: 1.0</span></p>

<p class=MsoNoSpacing><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document author: Daniel Cooper
2009/04/21</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document author: Merrigan Baylis
2009/04/22</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document author: Paul Calcraft
2009/04/22<br>
Document author: Adam McGinness 2009/04/23</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document author: Lawrence Dine
2009/04/27</span></p>

<p class=MsoNoSpacing><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document auditor: Ioanna Kyprianou
2009/04/30</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document auditor: Daniel Cooper
2009/04/30</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document auditor: Paul Calcraft
2009/04/30</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Document auditor: Sohani Amiruzzaman
2009/04/30</span></p>

<p class=MsoNoSpacing><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNoSpacing><span lang=EN-US>Last modification date:  2009/04/30</span></p>

<span style='font-size:12.0pt;line-height:115%;font-family:"Arial","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal style='margin-bottom:10.0pt;line-height:115%'>&nbsp;</p>

<p class=MsoNormal style='margin-bottom:10.0pt;line-height:115%'>&nbsp;</p>

<p class=MsoTocHeading>Contents</p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293547"><span lang=EN-GB>Notes</span><span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293548"><span lang=EN-GB>Architectural
</span><span lang=EN-GB>Design</span><span style='color:windowtext;display:
none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>5</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293549"><span lang=EN-GB>Tokeniser
&amp; Parser</span><span style='color:windowtext;display:none;text-decoration:
none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>6</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc229293550"><span lang=EN-GB>Tokeniser
and Tokens Detail</span><span style='color:windowtext;display:none;text-decoration:
none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>9</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc229293551"><span lang=EN-GB>Prototype</span><span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>10</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc229293552"><span lang=EN-GB
style='background:white'>Parser Detail</span><span style='color:windowtext;
display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>12</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc229293553"><span lang=EN-GB
style='background:white'>Prototype</span><span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>13</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc229293554"><span lang=EN-GB
style='background:white'>Prototype Testing</span><span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>18</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293555"><span lang=EN-GB
style='background:white'>Renderer</span><span style='color:windowtext;
display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>22</span></a></span></p>

<p class=MsoToc2><span lang=EN-US><a href="#_Toc229293556">Rendering Process
Detail<span style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>24</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc229293557">In Theory<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>24</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc229293558">In Java<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>25</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc229293559">In the BrowserMonkey
Browser<span style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>26</span></a></span></p>

<p class=MsoToc3><span lang=EN-US><a href="#_Toc229293560">Pseudo Code<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>27</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293561"><span lang=EN-GB
style='background:white'>View Manual</span><span style='color:windowtext;
display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>27</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293562"><span lang=EN-GB
style='background:white'>Logging</span><span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>28</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293563"><span lang=EN-GB
style='background:white'>Search</span><span style='color:windowtext;display:
none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>28</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293564"><span lang=EN-GB>Zoom</span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>31</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc229293565"><span lang=EN-GB>Follow
Link</span><span style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>32</span></a></span></p>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc229293547">Notes</a></h1>

<p class=MsoNormal>Since the last deliverable, we have moved Subversion server to
be hosted on Google Code. To request admin rights on this project, please email
any of the team leaders.</p>

<p class=MsoNormal>We made this move because of a few problems in the old
system which make updating and committing a time consuming process. The old svn
directory has been frozen and the new one has all the changes we’ve made to the
project from the point we moved over.</p>

<p class=Code><a href="http://code.google.com/p/browsermonkey/">http://code.google.com/p/browsermonkey/</a></p>

<p class=MsoNormal>We have also been forced to make a change in project leader
since our previous one was no longer able to stay with us for personal reasons.
We lost a member of the QA team on similar grounds as well. We are now left
with only 9 team members.</p>

<h1><span style='position:relative;z-index:-2'><span style='position:absolute;
left:35px;top:-32px;width:562px;height:898px'><img width=562 height=898
src="Low%20Level%20Design_files/image002.gif"></span></span><a
name="_Toc229293548">Architectural </a>Design</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<h1>&nbsp;</h1>

<p class=FigureCaptionStyle><span style='position:absolute;z-index:2;
margin-left:22px;margin-top:33px;width:593px;height:41px'>

<table cellpadding=0 cellspacing=0>
 <tr>
  <td width=593 height=41 bgcolor=white style='vertical-align:top;background:
  white'><span style='position:absolute;z-index:2'>
  <table cellpadding=0 cellspacing=0 width="100%">
   <tr>
    <td>
    <div style='padding:0pt 0pt 0pt 0pt'>
    <p class=MsoCaption><span lang=EN-US>Figure </span><span
    lang=EN-US>1</span><span lang=EN-US>: Browser Monkey Class diagram</span></p>
    </div>
    </td>
   </tr>
  </table>
  </span>&nbsp;</td>
 </tr>
</table>

</span><br>
<br>
<br>
</p>

<p class=MsoNormal>Some of the relationships in the above diagram are
compositions as opposed to aggregation. The difference is subtle, and is mostly
a conceptual one, where the implementation could often be identical. We have
made the distinction mostly based on lifetime control. The composition relationships
in our system are the following:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>GUI is composed of a DocumentPanel</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:72.0pt;text-indent:-18.0pt'><span
style='font-family:"Courier New"'>o<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span>The DocumentPanel as used in our application has its lifetime
controlled by the GUI. The GUI instantiates it, and when the GUI ceases to
exist (is closed), the DocumentPanel should also be destructed.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>DocumentPanel is composed of RenderNodes</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:72.0pt;text-indent:-18.0pt'><span
style='font-family:"Courier New"'>o<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span>The RenderNodes exist expressly for rendering parts of the
document in the DocumentPanel. When the DocumentPanel is destructed, so should
the RenderNodes be.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Document is composed of DocumentNodes</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:72.0pt;text-indent:-18.0pt'><span
style='font-family:"Courier New"'>o<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span>Analogous to RenderNodes for the DocumentPanel, the DocumentNodes
make up the Document.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Token contains (as composition) TokenType</p>

<p class=MsoListParagraphCxSpLast style='margin-left:72.0pt;text-indent:-18.0pt'><span
style='font-family:"Courier New"'>o<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span>The TokenType enumeration is only instantiated and used by the
Token class, it is only inspected as part of a Token by others (the Tokeniser).
When a Token is destructed, its TokenType instance should be destructed also.</p>

<h1><a name="_Toc229293549">Tokeniser &amp; Parser</a></h1>

<p class=MsoNormal>The tokeniser and the parser are responsible for turning an HTML
document into a tree of DocumentNodes which can later be rendered into a RenderNode
tree.</p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=609
height=736 src="Low%20Level%20Design_files/image003.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>2</span><span lang=EN-US>: Parser and Tokeniser Sequence Diagram</span></p>

<h2><img border=0 width=526 height=394
src="Low%20Level%20Design_files/image004.gif"></h2>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>3</span><span lang=EN-US>: Parser Initial Object Diagram</span></p>

<p class=MsoNormal><span lang=EN-US>Before the parsing process, the GUI has the
Document loaded into the DocumentPanel, but there are no render nodes yet, and
the Document and Parser contain only the root DocumentNode.</span></p>

<p class=MsoNormal><span style='background:white'>To demonstrate this process,
the following example HTML file has been constructed:</span></p>

<p class=Code>&lt;html&gt;</p>

<p class=Code>&lt;body&gt;</p>

<p class=Code>Test page&lt;br/&gt;</p>

<p class=Code>Test &lt;b&gt;bold text&lt;/b&gt;</p>

<p class=Code>&lt;/body&gt;</p>

<p class=Code>&lt;/html&gt;</p>

<p class=MsoNormal><span lang=EN-US>The Object Diagram below shows the result
of the parser as executed on this HTML file.</span></p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=628 src="Low%20Level%20Design_files/image005.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>4</span><span lang=EN-US>: Parser Completed Object Diagram</span></p>

<p class=MsoNormal>Once the parser is completed, the Tokeniser holds all the
tokens, and the parser has used these tokens to create the DocumentNode tree,
which is held by the Document.</p>

<h2><a name="_Toc229293550">Tokeniser and Tokens Detail</a></h2>

<p class=MsoNormal>The tokeniser splits up the raw text of the HTML document
into token objects. A token object represents an atomic segment of the HTML.
Consider the string “&lt;b&gt;bold&lt;/b&gt;”: this would produce three tokens
–“&lt;b&gt;”, “bold” and “&lt;/b&gt;”.</p>

<h3><a name="_Toc229293551">Prototype</a></h3>

<p class=MsoNormal>A prototype tokeniser has been developed, using a scripting
language called Ruby, to act as a proof of concept and as near- pseudo-code
documentation.</p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>class</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyTokeniser</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#attr_reader
is ruby short hand for a getter method</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'># so
in java we'd write getPage() and getToken()</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>attr_reader</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>page<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tokens</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#in
java this would be the public MonkeyTokeniser(String page){...}</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>initialize<b>(</b>page<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#puts
page</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>0</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>page<b>.</b>to_s</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tokens</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>Array<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>array</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>of</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyTokens</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tokenise</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>get_next_token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>?&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>[</b>@current_pos<b>]</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>   #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>is</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>this</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>a</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>[(</b>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>),</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>3</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;!--&quot;</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>is</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>this</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>a</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>comment</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#calculate
length of token and move token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag_token_end</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>.</b>index<b>(</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'--&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>)</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>raise</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;malformed
HTML&quot;</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>tag_token_end</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>nil</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag<b>.</b>length</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#calculate
length of token and move pointer - then add to token list</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag_token_end</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>.</b>index<b>(</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>)</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>raise</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;malformed
HTML&quot;</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>tag_token_end</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>nil</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>[</b>@current_pos<b>...</b>tag_token_end</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tokens</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag<b>.</b>length</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#calculate
length of text and move pointer - then add to token list</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text_token_end</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>.</b>index<b>(</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>[</b>@current_pos<b>...</b>text_token_end<b>]</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text_token_end</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>!=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>nil</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>[</b>@current_pos<b>...</b>@page<b>.</b>length<b>]</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text_token_end</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>nil</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tokens</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>.</b>length</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text<b>.</b>length</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tokenise</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>while</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@current_pos</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@page<b>.</b>length</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>get_next_token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>class</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyToken</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>attr_reader</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>full_tag<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>attributes<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>type</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>initialize<b>(</b>full_tag<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>type<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#@variables
are class variables</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#&lt;b&gt;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@full_tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>full_tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#:text
or :tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@type</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>type</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#:foo
=&gt; &quot;bar&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@attributes</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>Hash<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@end_tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>false</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#
grab the tag name of the tag, if it's text then just keep the whole thing</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>full_tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>type</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>type</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#regex
to get the a in &lt;a href=&quot;b&quot;&gt;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>full_tag<b>.</b>scan<b>(</b></span><span
style='font-size:10.0pt;font-family:"Courier New";color:#3F7F3F;background:
aqua'>/[\w:-]+/</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>)[</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:#007F7F;background:white'>0</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>]</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>      </span><b><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:#00007F;background:white'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>@tag<b>.</b>nil<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>        </span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:black;background:white'>raise</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F007F;background:white'>&quot;Error, tag is nil: #{@full_tag}&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>      </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>      </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>classify_tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>def</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>has_attributes<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F;background:white'>return</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>!</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>@attributes<b>.</b>empty<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>def</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>is_end_tag<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F;background:white'>return</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>@end_tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>def</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>is_start_tag<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F;background:white'>return</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>!</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>@end_tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>def</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>classify_tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'>#</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'># &lt;a foo=&quot;test&quot;
bar=&quot;test&quot; &gt;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'>#   produces three results: 1)a 2.1)foo
2.2)test 3.1)bar 3.2)test</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'>#</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'>#   This function creates a hash of the
attributes of a tag and determines if this tag is an end tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'>#</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'># 'scan' breaks up a string based on a regex,
with each group being a new element in an array. Sounds like hassle in java.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>atts</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>=</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray;background:white'> </span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:black;background:white'>@full_tag<b>.</b>scan<b>(</b></span><span
style='font-size:10.0pt;font-family:"Courier New";color:#3F7F3F;background:
aqua'>/&lt;[\w:-]+\s+(.*)&gt;/</span><b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black;background:white'>)</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>attr_arr</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>=</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray;background:white'> </span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:black;background:white'>atts<b>[</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F;
background:white'>0</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>].</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black;background:white'>to_s<b>.</b>scan<b>(</b></span><span
style='font-size:10.0pt;font-family:"Courier New";color:#3F7F3F;background:
aqua'>/\s*([\w:-]+)(?:\s*=\s*(&quot;[^&quot;]*&quot;|'[^']*'|([^&quot;'&gt;][^\s&gt;]*)))?/m</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>)</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'>#this is a bit like a for each loop</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>attr_arr<b>.</b>each</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'> </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F;background:white'>do</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>|</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>n<b>|</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>      </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>@attributes<b>[</b>n<b>[</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F;
background:white'>0</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>].</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black;background:white'>downcase<b>]</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'> </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>=</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>n<b>[</b></span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:#007F7F;background:white'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>]</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00;background:white'>#determine if the tag is an end tag by looking
for a / before the tag name ( &lt;/b&gt; )</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end_tag</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>=</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray;background:white'> </span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:black;background:white'>@full_tag<b>.</b>index<b>(</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F;
background:white'>'/'</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>,</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F;
background:white'>0</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>)</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F;background:white'>if</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>end_tag</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray;background:white'> </span><b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black;background:white'>!=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>nil</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>      </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>tag_pos</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>=</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray;background:white'> </span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:black;background:white'>@full_tag<b>.</b>index<b>(</b>@tag<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#007F7F;background:white'>0</span><b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black;background:white'>)</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>      </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>@end_tag</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>=</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray;background:white'> </span><b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:#00007F;background:white'>true</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'> </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F;background:white'>if</span></b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray;background:white'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>end_tag</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray;background:white'> </span><b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black;background:white'>&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>tag_pos</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>    </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray;
background:white'>  </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;background:white'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black;
background:white'>end</span></p>

<p class=MsoNormal><span style='background:white'>The tokeniser works by
keeping a counter of its position in the string to be evaluated then stepping
through. If it sees a ‘&lt;’ then it checks forward to the next “&gt;” and
assumes that to be a tag type token (unless it’s a comment). It then produces a
new token object. A token object is able to be passed a string like “&lt;foo
att=’bar’&gt;” and correctly identify that:</span></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'><span
style='background:white'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span style='background:white'>It’s a start tag</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='background:white'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span style='background:white'>It’s a foo tag</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:-18.0pt'><span
style='background:white'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span style='background:white'>It has an attribute “att” with the
value “bar”</span></p>

<p class=MsoNormal><span style='background:white'>Each token object is kept by
the tokeniser in a list. Although not demonstrated in this prototype, the
tokeniser must also perform basic syntactic error correction – that is to say
that the tokeniser must be able to correct “bad” HTML where tags are not closed
or invalid symbols are present.</span></p>

<h2><a name="_Toc229293552"><span style='background:white'>Parser Detail</span></a></h2>

<p class=MsoNormal><span style='background:white'>The parser </span>takes a
stream of tokens from the tokeniser and applies a set of rules on those tokens.
It then produces a list of DocumentNodes of various types. The parser checks
that:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'><span
style='background:white'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span style='background:white'>Each element is an element type we
can render</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='background:white'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span style='background:white'>Each element is correctly nested
in appropriate elements</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='background:white'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span style='background:white'>Each element has valid attributes</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:-18.0pt'><span
style='background:white'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span style='background:white'>Each element correctly terminates</span></p>

<p class=MsoNormal><span style='background:white'>It maintains a series of
lists which detail elements and how they are to be treated. In the
implementation, these lists will be created from a properties file when the
parser is created.</span></p>

<p class=MsoNormal><span style='background:white'>The parser is able to correct
basic HTML errors, like the incorrect nesting of tags and the improper use of
tags. It is however fairly limited and does not always produce the correct
output when given extremely poor HTML.</span></p>

<h3><a name="_Toc229293553"><span style='background:white'>Prototype</span></a></h3>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>class</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyParser</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>attr_reader</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>original_page<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>document_node</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>initialize<b>(</b>page<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@original_page</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>page</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tokeniser</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyTokeniser<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>page</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tokens</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tokeniser<b>.</b>tokens</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#define
all the tags and their general attributes. In the actual implementation</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#this
will be populated by a properties file.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#these
tags are to demo, and are by no means an exhaustive list.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@single_nestable_tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>[</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'HTML'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'head'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'body'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>that</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>can</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>only</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>be</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>used</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>once</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@table_tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>[</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'table'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'tr'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'td'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>table</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>need</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>a</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>special</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>case</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@nestable_tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>[</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'b'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'i'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'strong'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'em'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>normal<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>nestable<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tags</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@singuarly_nestable_tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>[</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'p'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>these</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>cannot</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>be</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>nested</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>inside</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>themselfs</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@leaf_tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=[</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'br'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'img'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>can</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>have</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>no</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>children</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@listed_tags</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=[</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'li'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'ol'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'ul'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> #</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>list</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>elements</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>also</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>need</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>a</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>special</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>case</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>Array<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>parse</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tokens<b>.</b>each_with_index</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>do</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>|</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>,</b>i<b>|</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#add HTML
if needed</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>i</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>0</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&amp;&amp;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>!=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>“html”</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@document_node</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyDocumentNode<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>“html”</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@document_node</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>i</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>0</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&amp;&amp;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>“html”</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@document_node</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyDocumentNode<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>“html”</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@document_node</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>type</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>is_start_tag<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00'>#if it's a table tag or if a row has been opened but not a cell
- add the appropriate elements</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@table_tags<b>.</b>member<b>?</b></span><span style='font-size:
10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_table_element</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>elsif</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@open_elements<b>.</b>length</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&gt;=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@open_elements<b>.</b>last<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;tr&quot;</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>||</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>last<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;table&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>             
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_table_element</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;td&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00'>#perform listed tag functions</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@listed_tags<b>.</b>member<b>?</b></span><span style='font-size:
10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_listed_element</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00'>#pre elements should not have any children, just text</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@open_elements<b>.</b>length</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&gt;=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&amp;&amp;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>last<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;pre&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@open_elements<b>.</b>last<b>.</b>text</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>last<b>.</b>text</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>full_tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00'>#For singularly nestable tags, check if the last tag is the
same. If it is</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00'>#fix the nesting, if not - carry on.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@singuarly_nestable_tags<b>.</b>member<b>?</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@open_elements<b>.</b>length</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&gt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&amp;&amp;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>last<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>             
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_end_token</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00'>#basic nestable tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@nestable_tags<b>.</b>member<b>?</b></span><span style='font-size:
10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00'>#add the leaf tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@leaf_tags<b>.</b>member<b>?</b></span><span style='font-size:
10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_leaf_element</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F7F00'>#close and remove the token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_end_token</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#add
a text element - but not without checking the state of the tables.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>length</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&gt;=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@open_elements<b>.</b>last<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;tr&quot;</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>||</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>last<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;table&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>           
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_table_element</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;td&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_text_element</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#Does
a standard list. If the user chooses to not close li tags then it assumes that
the next li</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#signifies
the start of the tag. Also, if no list type is given, it defaults to ul</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_listed_element</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'li'</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>length</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&gt;=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>[-</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>].</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;ol&quot;</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>||</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>[-</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>].</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;ul&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>elsif</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>[-</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>].</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;li&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_end_token</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>@open_elements<b>[-</b></span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>]</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_listed_element</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;ul&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_table_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;ul&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_start_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>elsif</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'ol'</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>||</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'ul'</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_start_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#ensures
that tables are properly nested.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_table_element</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'td'</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>length</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&gt;=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>[-</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>].</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;tr&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_table_element</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;tr&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_table_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;tr&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_start_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>elsif</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'tr'</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>length</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&gt;=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>[-</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>].</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;table&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_table_element</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;table&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>         
</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>do_start_token</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif";color:gray'> </span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_table_element</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyToken<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>'&lt;table&gt;'</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_start_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>elsif</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;table&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_start_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_leaf_element</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>last</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyDocumentNode<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>type<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>attributes<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_text_element</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_leaf_element</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>fix_nesting_error</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>reverse_each</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>do</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>|</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>element<b>|</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>element<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>delete</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>element</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>break</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_end_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>last<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>pop</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>fix_nesting_error</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#adds
a new standard token onto the last open element and appends a new element onto</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#that
list</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>do_start_token</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>new_node</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyDocumentNode<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>tag<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>type<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>token<b>.</b>attributes<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>last</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>new_node</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>new_node</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@document_node</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>first</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@open_elements<b>.</b>size</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#007F7F'>1</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>class</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyDocumentNode</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#A
MonkeyDocumentNode is a node in a tree. It has children and a parent.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#In
the implementation, two types of node will exist - tag and text.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#both
a getter and a setter</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>attr_accessor</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>type<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>attributes<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>children</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>initialize<b>(</b>value<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>type<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>attributes</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>Hash<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>)</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>value</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@type</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>type</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@children</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>Array<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@attributes</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>attributes</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#aliases
for the tag method.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>return</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text<b>=(</b>text<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#This
allow to add documentnode to the children of a parent node  documentnode1
&lt;&lt; documentnode2</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>value<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@children</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>value</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>return</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>value</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#each
provides the standard ruby way of iterating over a collection</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#We're
traversing the tree recursively and each time we find an element we yield back
to the calling block.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>each</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>yield</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>value</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@children<b>.</b>each</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>do</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>|</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>child_node<b>|</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>child_node<b>.</b>each</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>{</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>|</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>e<b>|</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>yield</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>e</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>}</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F7F00'>#prints
as if it was still HTML</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>friendly_print</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@type</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>return</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag<b>+</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;/&gt;&quot;</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@children<b>.</b>empty<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag<b>+</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&gt;&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@children<b>.</b>each</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>do</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>|</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>|</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>.</b>friendly_print</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;/&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag<b>+</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&gt;&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>else</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>return</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>@tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>e</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>nd</span></p>

<p class=MsoNormal><span style='background:white'>&nbsp;</span></p>

<h2><a name="_Toc229293554"><span style='background:white'>Prototype Testing</span></a></h2>

<p class=MsoNormal><span style='background:white'>In order to informally test
the workings of the tokeni</span>ser and the parser, a small test suite has
been written. The code for this is listed here:</p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>def</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>page<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>name</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;-------------------------------------------&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;Test
name: &quot;</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>+</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>name</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;testing
with string: &quot;</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>+</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>page</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;testing
tokeniser:&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tokeniser</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyTokeniser<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>page<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tokeniser<b>.</b>tokens<b>.</b>each</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>do</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>|</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>|</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>.</b>type</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;start_tag:
&quot;</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>n<b>.</b>is_start_tag<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;end_tag:
&quot;</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#00007F'>if</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>n<b>.</b>is_end_tag<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>.</b>tag</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>.</b>has_attributes<b>?</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;
with attributes:&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>        </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>.</b>attributes<b>.</b>each_pair</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>{|</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>key<b>,</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>value<b>|</b></span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>&lt;&lt;</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;
#{key}=#{value}&quot;</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>}</span></b></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>      </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>string</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>    </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;text:&quot;</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>+</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>.</b>tag</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>if</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>n<b>.</b>type</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>==</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>:</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>text</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>end</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;testing
parser:&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>parser</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>=</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>MonkeyParser<b>.</b></span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#00007F'>new</span></b><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>(</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>page<b>)</b></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>parser<b>.</b>parse</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>parser<b>.</b>document_node<b>.</b>friendly_print</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'>  </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>puts</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;-------------------------------------------&quot;</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>end</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>&nbsp;</span></p>

<p class=MsoNormal>The test will focus on the edge cases of the parser –
correcting mistakes in the HTML.</p>

<p class=MsoNormal>The tests are defined as so:</p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;b&gt;hello&lt;i&gt;world&lt;/i&gt;&lt;/b&gt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;Simple&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;b&gt;hello&lt;i&gt;world&lt;/b&gt;&lt;/i&gt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;Incorrect
Nesting&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;tr&gt;hello&lt;/tr&gt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;Missing
table cell&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;html&gt;&lt;table&gt;&lt;td&gt;hello&lt;/table&gt;&lt;/td&gt;&lt;/html&gt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;Badly
Formed Table&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;table&gt;&lt;tr&gt;hello&lt;table&gt;world&lt;/table&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;badly
formed and nested tables&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;li&gt;hello&lt;li&gt;world&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;li
shortcut&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;hello
world&quot;</span><b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>,</span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:gray'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:#7F007F'>&quot;just text&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;p&gt;hello&lt;p&gt;world&lt;/p&gt;&lt;/p&gt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;p
nesting&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;ol&gt;&lt;b&gt;hello&lt;/b&gt;&lt;li&gt;world&lt;/li&gt;&lt;/ol&gt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;element
inside list&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;&lt;br&gt;hello&lt;/br&gt;&quot;</span><b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&quot;nest
attempt on br&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:black'>run_test</span><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Courier New";color:#7F007F'>&quot;&lt;html&gt;&lt;body&gt;Test
page&lt;br/&gt;Test &lt;b&gt;bold
text&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><b><span style='font-size:
10.0pt;font-family:"Verdana","sans-serif";color:black'>,</span></b><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:gray'> </span><span
style='font-size:10.0pt;font-family:"Courier New";color:#7F007F'>&quot;Standard
Example&quot;</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:#7F007F'>&nbsp;</span></p>

<p class=MsoNormal>And the output of this script is as follows: </p>

<p class=MsoNoSpacing>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: Simple</p>

<p class=Code>testing with string:
&lt;b&gt;hello&lt;i&gt;world&lt;/i&gt;&lt;/b&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: b</p>

<p class=Code>text:hello</p>

<p class=Code>start_tag: i</p>

<p class=Code>text:world</p>

<p class=Code>end_tag: i</p>

<p class=Code>end_tag: b</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;b&gt;hello&lt;i&gt;world&lt;/i&gt;&lt;/b&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: Incorrect Nesting</p>

<p class=Code>testing with string: &lt;b&gt;hello&lt;i&gt;world&lt;/b&gt;&lt;/i&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: b</p>

<p class=Code>text:hello</p>

<p class=Code>start_tag: i</p>

<p class=Code>text:world</p>

<p class=Code>end_tag: b</p>

<p class=Code>end_tag: i</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;b&gt;hello&lt;i&gt;world&lt;/i&gt;&lt;/b&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: Missing table cell</p>

<p class=Code>testing with string: &lt;tr&gt;hello&lt;/tr&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: tr</p>

<p class=Code>text:hello</p>

<p class=Code>end_tag: tr</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;hello&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: Badly Formed Table</p>

<p class=Code>testing with string: &lt;html&gt;&lt;table&gt;&lt;td&gt;hello&lt;/table&gt;&lt;/td&gt;&lt;/html&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: HTML</p>

<p class=Code>start_tag: table</p>

<p class=Code>start_tag: td</p>

<p class=Code>text:hello</p>

<p class=Code>end_tag: table</p>

<p class=Code>end_tag: td</p>

<p class=Code>end_tag: HTML</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;hello&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: badly formed and nested tables</p>

<p class=Code>testing with string:
&lt;table&gt;&lt;tr&gt;hello&lt;table&gt;world&lt;/table&gt;&lt;/tr&gt;&lt;/table&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: table</p>

<p class=Code>start_tag: tr</p>

<p class=Code>text:hello</p>

<p class=Code>start_tag: table</p>

<p class=Code>text:world</p>

<p class=Code>end_tag: table</p>

<p class=Code>end_tag: tr</p>

<p class=Code>end_tag: table</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;hello&lt;table&gt;&lt;tr&gt;&lt;td&gt;world&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: li shortcut</p>

<p class=Code>testing with string: &lt;li&gt;hello&lt;li&gt;world</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: li</p>

<p class=Code>text:hello</p>

<p class=Code>start_tag: li</p>

<p class=Code>text:world</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;ul&gt;&lt;li&gt;hello&lt;/li&gt;&lt;li&gt;world&lt;/li&gt;&lt;/ul&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: just text</p>

<p class=Code>testing with string: hello world</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>text:hello world</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;hello world&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: p nesting</p>

<p class=Code>testing with string:
&lt;p&gt;hello&lt;p&gt;world&lt;/p&gt;&lt;/p&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: p</p>

<p class=Code>text:hello</p>

<p class=Code>start_tag: p</p>

<p class=Code>text:world</p>

<p class=Code>end_tag: p</p>

<p class=Code>end_tag: p</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;p&gt;hello&lt;/p&gt;&lt;p&gt;world&lt;/p&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: element inside list</p>

<p class=Code>testing with string:
&lt;ol&gt;&lt;b&gt;hello&lt;/b&gt;&lt;li&gt;world&lt;/li&gt;&lt;/ol&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: ol</p>

<p class=Code>start_tag: b</p>

<p class=Code>text:hello</p>

<p class=Code>end_tag: b</p>

<p class=Code>start_tag: li</p>

<p class=Code>text:world</p>

<p class=Code>end_tag: li</p>

<p class=Code>end_tag: ol</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;ol&gt;&lt;b&gt;hello&lt;/b&gt;&lt;li&gt;world&lt;/li&gt;&lt;/ol&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: nest attempt on br</p>

<p class=Code>testing with string: &lt;br&gt;hello&lt;/br&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: br</p>

<p class=Code>text:hello</p>

<p class=Code>end_tag: br</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;br/&gt;hello&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>&nbsp;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code>Test name: Standard Example</p>

<p class=Code>testing with string: &lt;html&gt;&lt;body&gt;Test
page&lt;br/&gt;Test &lt;b&gt;bold text&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;</p>

<p class=Code>testing tokeniser:</p>

<p class=Code>start_tag: html</p>

<p class=Code>start_tag: body</p>

<p class=Code>text:Test page</p>

<p class=Code>start_tag: br</p>

<p class=Code>text:Test </p>

<p class=Code>start_tag: b</p>

<p class=Code>text:bold text</p>

<p class=Code>end_tag: b</p>

<p class=Code>end_tag: body</p>

<p class=Code>end_tag: html</p>

<p class=Code>testing parser:</p>

<p class=Code>&lt;html&gt;&lt;body&gt;Test page&lt;br/&gt;Test &lt;b&gt;bold
text&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;</p>

<p class=Code>-------------------------------------------</p>

<p class=Code></p>

<p class=Code>&nbsp;</p>

<p class=MsoNormal>All but the last of these tests test bad data, and as such
there is not standard way to know if it the corrections are correct. However,
we believe that the parser prototype is able to make a good attempt at invalid
code while being compliant on standard code (as proved by the standard example).</p>

<p class=MsoNormal><span style='background:white'>&nbsp;</span></p>

<h1><a name="_Toc229293555"><span style='background:white'>Renderer</span></a></h1>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=412 id="Picture 2" src="Low%20Level%20Design_files/image006.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>5</span><span lang=EN-US>: Renderer Sequence Diagram: Rendering the
DocumentNode tree into RenderNodes in the DocumentPanel</span></p>

<p class=MsoNormal><span style='background:white'>&nbsp;</span></p>

<p class=MsoNormal><span style='background:white'>The renderer takes the
DocumentNode tree as outputted by the parser, and creates a RenderNode tree.</span></p>

<p class=MsoNormal><span style='background:white'>The same example HTML file as
used for the parser will be used for demonstration:</span></p>

<p class=Code>&lt;html&gt;</p>

<p class=Code>&lt;body&gt;</p>

<p class=Code>Test page&lt;br/&gt;</p>

<p class=Code>Test &lt;b&gt;bold text&lt;/b&gt;</p>

<p class=Code>&lt;/body&gt;</p>

<p class=Code>&lt;/html&gt;</p>

<p class=MsoNormal><span style='background:white'>Before the renderer process
begins, the state is as follows:</span></p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=515 id="Picture 8" src="Low%20Level%20Design_files/image007.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>6</span><span lang=EN-US>: Renderer Initial Object Diagram</span></p>

<p class=MsoNormal><span style='background:white'>The DocumentPanel contains no
rootRenderNode, so at this point no components are visible, and the render tree
hasn’t been created. The parser has provided the Document with a DocumentNode
tree, the root of which is the HTML tag, a TagDocumentNode object called htmlRoot.</span></p>

<p class=MsoNormal><span style='background:white'>After the process, the
following is the state of the system:</span></p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=440 id="Picture 9" src="Low%20Level%20Design_files/image008.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>7</span><span lang=EN-US>: Renderer Completed Object Diagram</span></p>

<p class=MsoNormal><span style='background:white'>The DocumentPanel now has a
root RenderNode which is a LayoutRenderNode containing the two text nodes that
comprise the document. The first text node (representing the first line) has
the text “Test page” and the second contains “Test bold text” with the BOLD
attribute assigned to the range of characters “bold text”.</span></p>

<h2><a name="_Toc229293556"><span lang=EN-US>Rendering Process Detail</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The BrowserMonkey program needs to
interpret a large number of tags and do this process in a modular way to allow
for future usage of the tag handling system. Most importantly this must be done
very efficiently. It would be possible create an HTML tag handler by using an
enormous if-else statement but this would be hard to debug and horrible to
reuse or update (for example to new HTML standards). This is why we have
decided to use reflection.</span></p>

<h3><a name="_Toc229293557"><span lang=EN-US>In Theory</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Reflection is the process by which a
computer program can observe and modify its own structure and behaviour.</span></p>

<p class=MsoNormal><span lang=EN-US>Reflection allows the programmer to use
multiple different classes and methods in a generic way, perfect for something
like HTML rendering where you have many different processes used to draw the
code. Reflection is also very handy for creating a modular piece of software
such as a tag interpreter.</span></p>

<p class=MsoNormal><span lang=EN-US>Essentially when you instantiate a class
using a reflection method you don’t need to know what the class is or what
methods it has, the reflection implementation will have methods that will allow
you to grab any methods a class has and invoke the one you need by name and
signature.</span></p>

<h3><a name="_Toc229293558"><span lang=EN-US>In Java</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Java has a properties class that can be
used to aid a system like this. There’s a specific convention to use to create
a properties file which can be read by included methods. This will then
generate a kind of hash table that can be accessed easily, to map some relevant
data (in this case the tag type string) to the name of a class to instantiate
with reflection.</span></p>

<h4><span lang=EN-US>External Files</span></h4>

<p class=MsoNormal><span lang=EN-US>To access the external file to be read into
the properties object:</span></p>

<p class=Code>Code:</p>

<p class=Code>        Properties properties = new Properties();</p>

<p class=Code>        properties.load(“&lt;root&gt;:\example.properties”);</p>

<p class=Code>&nbsp;</p>

<p class=MsoNormal><span lang=EN-US>You can then access the properties in this
file using a Hash table-like key function:</span></p>

<p class=Code>Code:</p>

<p class=Code>       String thisPropertyIsSetTo = properties.get(thisProperty);</p>

<p class=MsoNormal><span lang=EN-US>This Code will find the property key
‘thisProperty’ and set the String thisPropertyIsSetTo to the value stored in
the properties file as the value for ‘thisProperty’.</span></p>

<h4><span lang=EN-US>Reflection</span></h4>

<p class=MsoNormal><span lang=EN-US>Java has a built in package of classes for
handling reflection: java.lang.reflect.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is some code for a simple example of
reflection. This serves to demonstrate how Java reflection code looks and could
be used in our application.</span></p>

<p class=MsoNormal><span lang=EN-US>Code:</span></p>

<p class=Code><span lang=EN-US> </span></p>

<span lang=EN-US style='font-size:12.0pt;line-height:115%;font-family:"Arial","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:10.0pt;
margin-left:0cm;line-height:115%'><span style='font-size:10.0pt;line-height:
115%;font-family:"Courier New"'>&nbsp;</span></p>

<p class=Code>  import java.lang.reflect.*;</p>

<p class=Code> </p>

<p class=Code>   public class DumpMethods {</p>

<p class=Code>      public static void main(String args[])</p>

<p class=Code>      {</p>

<p class=Code>         try {</p>

<p class=Code>            Class c = Class.forName(args[0]);</p>

<p class=Code>            Method m[] = c.getDeclaredMethods();</p>

<p class=Code>            for (int i = 0; i &lt; m.length; i++)</p>

<p class=Code>            System.out.println(m[i].toString());</p>

<p class=Code>         }</p>

<p class=Code>         catch (Throwable e) {</p>

<p class=Code>            System.err.println(e);</p>

<p class=Code>         }</p>

<p class=Code>      }</p>

<p class=Code>   }</p>

<p class=MsoNormal><span lang=EN-US>This code reads the command line arguments
and compares the first argument to all available classes in java. If it finds a
matching class it will output a toString of each method that class contains. If
there is no matching class it will throw an error.</span></p>

<h3><a name="_Toc229293559"><span lang=EN-US>In the BrowserMonkey Browser</span></a></h3>

<p class=MsoNormal><span lang=EN-US>To apply the above techniques in the
BrowserMonkey Browser we will use a Class for each HTML tag that extends an
abstract class called TagRenderer that has a render() method which for each
different class tag will have code used for rendering the item related to the
current tag. </span></p>

<p class=MsoNormal><span lang=EN-US>There will be an external properties file
that will be loaded into a Map within the Renderer class during its constructor
code – this will map the tag type strings (e.g. “b”, “center”, “html”) to
TagRenderer plugin subclasses.</span></p>

<p class=MsoNormal><span lang=EN-US>When rendering DocumentNodes into
RenderNodes, the DocumentPanel calls renderRoot on the Renderer object, passing
in the DocumentNode tree as the root node.</span></p>

<p class=MsoNormal><span lang=EN-US>This in turn instantiates a root
LayoutRenderNode to hold the document’s render nodes, and then calls render
with default formatting.</span></p>

<p class=MsoNormal><span lang=EN-US>The render method takes the given
DocumentNode, if it is a TextDocumentNode, it handles the rendering itself.
This involves adding the text string in the node to the current TextRenderNode
for the parent render node it is in, with the current formatting.
Alternatively, if the DocumentNode is a TagDocumentNode, the rendering
responsibility is deferred to the appropriate implementation of TagRenderer, as
specified by the properties file (via the Map).</span></p>

<p class=MsoNormal><span lang=EN-US>TagRenderers are supplied with a reference
to the Renderer itself, the TagDocumentNode, the parent RenderNode and the
current formatting. In order to render a bold tag for example, the TagRenderer
would defer the responsibility of rendering all of its children directly back
to the Renderer, but with a modified formatting object which adds bold to the
attributes. More complex tags like table will in fact instantiate their own
subclasses of RenderNode (e.g. TableRenderNode) and add them to the parent
render node as a component, and then defer the rendering back to Renderer, but
with the new TableRenderNode as the parent node. In this way, tag rendering is
recursive, and external plugin TagRenderers can still make use of the entire
standard rendering code (and other plugins) for their child nodes. Our
application need not know that TableRenderNode exists; it will handle its
rendering itself as a Swing component, and will be instantiated by the
potentially external TagRenderer as per the properties file.</span></p>

<h3><a name="_Toc229293560"><span lang=EN-US>Pseudo Code</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A simple pseudo code representation of how
the above ideas would work within the program:</span></p>

<p class=MsoNormal><span lang=EN-US>During Renderer Constructor:</span></p>

<p class=Code>Map rendererMap = new Map();</p>

<p class=Code>properties.load(&lt;root&gt;:\properties.txt)</p>

<p class=Code>tags = properties.propertyNames()</p>

<p class=Code>for each tag in tags</p>

<p class=Code>      String tagClass = properties.get(tag)</p>

<p class=Code>      TagRenderer thisTagRenderer = new Class.forName(tagClass)</p>

<p class=Code>      rendererMap.add(tag,thisTagRenderer)</p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The above code builds the renderMap from
the properties file when the renderer is first initialised. This allows the
renderer to find the TagRenderers later during the rendering process:</span></p>

<p class=MsoNormal><span lang=EN-US>During Rendering Process:</span></p>

<p class=Code>render() [called by renderRoot, and then recursively by
TagRenderers]</p>

<p class=Code>      if documentNode is TagDocumentNode</p>

<p class=Code>            currentTagRenderer = rendererMap.get(documentNode tag
type)</p>

<p class=Code>            currentTagRenderer.render(documentNode as
TagDocumentNode, ...)</p>

<p class=Code>      else</p>

<p class=Code>            add text into parent’s current TextRenderNode with
formatting</p>

<p class=Code>&nbsp;</p>

<p class=MsoNormal><span lang=EN-US>Rendering is a recursive process, TagRenderers
should initiate (by calling back to the Renderer) the rendering of their children.</span></p>

<h1><a name="_Toc229293561"><span style='background:white'>View Manual</span></a></h1>

<p class=MsoNormal><span style='background:white'>To view the manual, the
software </span>makes use of the previous processes linked together. To
illustrate how these are linked, here is a sequence diagram for this process:</p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=356 id="Picture 1" src="Low%20Level%20Design_files/image009.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>8</span><span lang=EN-US>: View Manual Sequence Diagram</span></p>

<p class=MsoNormal><span style='background:white'>As can be seen from the
notes, it makes use of the Parsing/Tokenising </span>and Rendering processes.</p>

<h1><a name="_Toc229293562"><span style='background:white'>Logging</span></a></h1>

<p class=MsoNormal><span style='background:white'>Java provides a built in
logging tool</span> which is able to write well formatted and time stamped logs
to a file of our choosing. A thin static wrapper called BrowserMonkeyLogger
will be produced that will allow the programmer – from anywhere that the
utilities classes have been imported – to write to the log at a given level of
severity: ranging from info to fatal error.</p>

<h1><a name="_Toc229293563"><span style='background:white'>Search</span></a></h1>

<p class=MsoNormal><span style='background:white'>Searching is one of the areas
where there is some change from the high level design. Due to the built in java
API we’re using in the DocumentPanel, which enables highlighting on the view
level, there is no longer a need to split up render nodes as we previously
thought.</span></p>

<p class=MsoNormal><span style='background:white'>The below sequence diagram
illustrates the steps that are required.</span></p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=320 id="Picture 3" src="Low%20Level%20Design_files/image010.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>9</span><span lang=EN-US>: Search Sequence Diagram</span></p>

<p class=MsoNormal>The process of searching loops through all the
TextRenderNodes in the Document and adds their AttributedCharacterIterators to
an array, textRanges. This array gets passed into the highlightSearchTerms
static method, which tries to find instances of the search term (which it can
find even if straddling multiple character iterators) and then uses the
attributed iterator to add highlighting to the appropriate parts of the
strings.</p>

<p class=MsoNormal>The Object Diagram representing the state of the system
before a search can be seen by referring to the Renderer Completed Object
Diagram above. It represents the state of all the components as a page is being
viewed. The user would then opt to search via the GUI, and the following would
be the resulting Object Diagram. This assumes the user has searched for “Test
bold”:</p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=432 id="Picture 10" src="Low%20Level%20Design_files/image011.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>10</span><span lang=EN-US>: Search Completed Object Diagram</span></p>

<p class=MsoNormal>The second text render node, textRender1, has had its
AttributedString updated to add a highlighted range over the characters “Test
bold”, and the GUI has updated to reflect the search – the status bar and
search text specifically.</p>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc229293564">Zoom</a></h1>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=353 id="Picture 4" src="Low%20Level%20Design_files/image012.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>11</span><span lang=EN-US>: Zoom Sequence Diagram</span></p>

<p class=MsoNormal>Similar to searching, the zoom loops through all
TextRenderNodes and scales up the size attributes of the text according to the
new zoom level.</p>

<p class=MsoNormal>The initial Object Diagram for this feature is also the
Renderer Completed Object Diagram.</p>

<p class=MsoNormal>After zooming to a level of 125%, the Object Diagram is the
following:</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=450 id="Picture 11" src="Low%20Level%20Design_files/image013.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>12</span><span lang=EN-US>: Zoom Completed Object Diagram</span></p>

<p class=MsoNormal>The AttributedStrings in the TextRenderNodes have been
updated to reflect the new zoom level. The GUI holds this new zoom value as a
percentage, and the DocumentPanel holds it as a floating point scale factor.
The way our renderer works uses Swing resizable components, so resizing the
text will cause the “preferred size” of that component to increase, and with
that any components containing that (e.g. a table cell) will enlarge
accordingly. In this way, it allows us to centre the zooming functionality on
the text and allow the rest of the page to react correctly without having to
write lots of explicit zooming code.</p>

<h1><a name="_Toc229293565">Follow Link</a></h1>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=153 id="Picture 5" src="Low%20Level%20Design_files/image014.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>13</span><span lang=EN-US>: Follow Link Sequence Diagram</span></p>

<p class=MsoNormal>The details of the DocumentPanel.load(path) method can be seen
in the View Manual Sequence Diagram (which in turn refers to the Renderer and
Parser/Tokeniser diagrams).</p>

<p class=MsoNormal>The following is a cut down Object Diagram of a document
called linkerDocument.html which contains a link to a document named
destination.html. For brevity, the detailed document and render trees have been
omitted, they would be very similar to those featured in the Renderer Completed
Object Diagram.</p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=215 id="Picture 12" src="Low%20Level%20Design_files/image015.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>14</span><span lang=EN-US>: Follow Link Initial Object Diagram</span></p>

<p class=MsoNormal>After the link is clicked, the state of the system would be
the following:</p>

<p class=MsoNormal style='page-break-after:avoid'><img border=0 width=601
height=215 id="Picture 13" src="Low%20Level%20Design_files/image016.gif"></p>

<p class=FigureCaptionStyle><span lang=EN-US>Figure </span><span
lang=EN-US>15</span><span lang=EN-US>: Follow Link Completed Object Diagram</span></p>

<p class=MsoNormal>The new document is now loaded as shown by the GUI with the
updated address bar and Document with new path.</p>

</div>

</body>

</html>
